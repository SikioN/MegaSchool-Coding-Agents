# MegaSchool Coding Agents

Добро пожаловать в проект **MegaSchool Coding Agents**. Это система автономных AI-разработчиков, к которой вы можете подключить свой репозиторий.

**Что умеет система:**
1.  **Code Agent**: Пишет код по вашему описанию в Issue.
2.  **Reviewer Agent**: Проверяет каждый Pull Request и ищет ошибки.
3.  **Fixer Loop**: Исправляет код по вашим комментариям (команда `/fix`).
4.  **Auto-Setup**: Автоматически определяет "чистые" репозитории и предлагает настроить окружение (linter, ci/cd).
5.  **Interactive Refinement**: Если задача описана недостаточно подробно, агент отклонит ее. Вы можете дополнить задачу через комментарии (`/retry fix...`), и агент начнет работу, не требуя создания нового Issue.

**Жизненный Цикл Задачи:**
1.  **Issue**: Вы создаете задачу с лейблом `ready-to-code`.
2.  **Валидация**: Агент проверяет описание.
    *   *Если OK*: Начинает работу.
    *   *Если Reject*: Снимает лейбл `ready-to-code` и пишет комментарий с причиной.
3.  **Уточнение**: Вы добавляете комментарий с деталями (используйте команду `/retry` или верните лейбл вручную).
4.  **PR**: Агент создает Pull Request с решением.
5.  **Review**: Вы комментируете PR (команда `/fix`), агент исправляет.

**Web Dashboard**: [Посмотреть статус агента в реальном времени](https://bbanv77fpp9clmjgi7r9.containers.yandexcloud.net/)  
**[Смотрите результаты живого эксперимента (DEMO.md)](DEMO.md)**

## Метрики Производительности

Мы провели серию из **10 экспериментов** (алгоритмические задачи), чтобы оценить качество работы агента.

| Метрика | Значение | Комментарий |
| :--- | :--- | :--- |
| **Success Rate** | **100%** | 10 из 10 задач решены корректно (код валиден). |
| **Avg. Time** | **~7.2s** | Среднее время генерации решения (без учета CI/CD). |
| **Iterations** | **1.0** | Все задачи решены с первой попытки (Zero-Shot). |

*Методология: Замеры проведены с помощью скрипта `experiments/benchmark.py` на модели gpt-4o-mini (через Proxy).*

## Эксперимент: Исправление багов (Bug Fix)

Мы также протестировали способность агента работать с **существующим кодом** и исправлять ошибки, описанные пользователем.

**Сценарий:**
*   Создано мини-приложение "Калькулятор оценок" (в папке `experiments/bug_fix_app`).
*   Внедрен баг: `ZeroDivisionError` при пустом списке оценок.
*   Создан Issue: "Приложение падает, если у студента нет оценок. Исправь это".

**Результат:**
Агент проанализировал зависимые файлы (`main.py`, `calculator.py`), нашел ошибку в логике `calculator.py` и добавил проверку на пустой список. Остальной код остался нетронутым.
*Подробный отчет:* `experiments/BUG_FIX_REPORT.md`

---

## Как проверить работу (Демо)

Вы можете сами убедиться, что агент работает:
1.  Откройте **[Dashboard](https://bbanv77fpp9clmjgi7r9.containers.yandexcloud.net/)**.
2.  Создайте Issue в этом репозитории с лейблом `ready-to-code`.
3.  Следите за логами в Дашборде — вы увидите, как агент подхватит задачу!

---

## Способы использования

### 1. Подключение готового агента (Самый быстрый)

Мы уже развернули и настроили агента. Вам не нужно ничего устанавливать.

1.  **Установите наше приложение**: [Ссылка на установку приложения](https://github.com/apps/megaschool-agent-sikion).
2.  Выберите репозитории, к которым хотите дать доступ.
3.  **ВАЖНО (!):** В настройках репозитория (`Settings` -> `Actions` -> `General` -> `Workflow permissions`) поставьте галочку **"Allow GitHub Actions to create and approve pull requests"**.
    *   *Без этого GitHub запретит агенту создавать Pull Request, даже если у него есть права.*
4.  Создайте Issue с лейблом `ready-to-code`. Агент приступит к работе!

*(Примечание: В этом режиме агент работает на нашем демонстрационном сервере).*

### 2. Запуск у себя (Свои ключи / GitHub Actions)

Если вы хотите использовать **свои API ключи** (OpenAI/Yandex) или опасаетесь за приватность данных, запустите агента в своем аккаунте через GitHub Actions.

1.  **Сделайте Fork** этого репозитория.
2.  Перейдите в **Settings -> Secrets and variables -> Actions**.
3.  Добавьте ваши ключи:
    *   `LLM_API_KEY`: Ваш ключ (OpenAI/Yandex).
    *   `YC_FOLDER_ID`: ID папки (если используете Яндекс).
4.  Включите Actions во вкладке **Actions** (кнопка "I understand... enable workflows").

Теперь агент будет работать внутри вашего форка, используя ваши ключи.

---

## Развертывание "Своего" Сервера (Advanced)

Если вы хотите поднять **собственную копию** сервера с Webhooks (как в варианте 1, но на вашем железе):

Инструкция по созданию и настройке своего GitHub App находится в файле [docs/github_app_setup.md](docs/github_app_setup.md).
Это позволит вам иметь полный контроль над приложением и вебхуками.

---

### 3. Запуск через Docker (Контейнер)

Если вы предпочитаете Docker, мы подготовили всё необходимое.

1.  **Соберите образ**:
    ```bash
    docker build -t megaschool-agent .
    ```

2.  **Запустите контейнер**:
    Нужно пробросить переменную `.env` или передать ключи напрямую.

    ```bash
    # Вариант с файлом .env (рекомендуется)
    docker run -d -p 8000:8080 --env-file .env --name my-agent megaschool-agent
    ```

### 4. Запуск через Docker Compose

Самый правильный способ (Infrastructure as Code). Убедитесь, что у вас есть файл `.env`.

```bash
docker-compose up -d --build
```
Сервер запустится на порту 8000. Внесите изменения в код — сервер перезагрузится автоматически (volume bind mount).

3.  Сервер доступен на `http://localhost:8000`. Настройте ваш туннель (ngrok) на этот порт.

---

## Конфигурация (Своя LLM)

Проект поддерживает любую LLM, совместимую с OpenAI API (включая YandexGPT через адаптер).
Вы можете управлять моделью через переменные окружения (или GitHub Secrets):

*   `LLM_BASE_URL`: Адрес API (например `https://api.openai.com/v1`).
*   `LLM_MODEL`: Имя модели (например `gpt-4o`, `yandexgpt-lite`).
*   `MAX_ITERATIONS`: Максимальное число попыток исправления ошибок (по умолчанию: 5).

---

## Контакты

Автор: Муравья Никита Романович
Telegram: [t.me/nmuravya](https://t.me/nmuravya)

*Проект разработан в рамках соревнования MegaSchool.*
