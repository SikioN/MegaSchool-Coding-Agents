# MegaSchool Coding Agents

Автономная система AI-разработчиков, которая пишет код, проверяет Pull Request'ы и исправляет ошибки на основе описаний на естественном языке.

## Возможности системы

1. **Code Agent**: Пишет код на основе описаний в Issue
2. **Reviewer Agent**: Автоматически проверяет Pull Request'ы
3. **Fixer Loop**: Итеративно исправляет код на основе обратной связи (команда `/fix`)
4. **Auto-Setup**: Определяет пустые репозитории и предлагает настроить окружение (linter, CI/CD)
5. **Interactive Refinement**: Отклоняет расплывчатые задачи и позволяет уточнить их через комментарии (`/retry`)
6. **Smart Context (RAG)**: Строит карту проекта и выбирает только релевантные файлы

## Жизненный цикл задачи

1. **Issue**: Создайте задачу с меткой `ready-to-code`
2. **Валидация**: Агент проверяет качество описания
   - Если OK → начинает работу
   - Если отклонено → снимает метку и объясняет причину
3. **Уточнение**: Добавьте детали в комментарии (используйте `/retry` или верните метку)
4. **PR**: Агент создает Pull Request с решением
5. **Review**: Комментируйте PR с `/fix` для запроса изменений

## Web Dashboard

Отслеживайте активность агента в реальном времени: [Dashboard](https://bbanv77fpp9clmjgi7r9.containers.yandexcloud.net/)

---

## Демо-эксперимент: Отклонение + Успешное выполнение

Этот эксперимент демонстрирует механизм валидации агента и полный рабочий процесс.

### Шаг 1: Некорректный запрос (Отклонение)

**Создайте Issue:**
- **Заголовок**: `Add feature`
- **Описание**: `Make it better`
- **Метка**: `ready-to-code`

**Ожидаемый результат:**
1. Агент проверяет задачу
2. Отклоняет её с комментарием: *"Описание слишком расплывчатое. Укажите, какую функцию добавить, и предоставьте детали реализации."*
3. Снимает метку `ready-to-code`
4. Dashboard показывает: `Task Rejected`

### Шаг 2: Корректный запрос (Успех)

**Добавьте комментарий к тому же Issue:**
```
Создай новый Python файл `src/utils/logger.py` с простой функцией логирования:
- Имя функции: setup_logger(name: str)
- Должна настраивать и возвращать экземпляр логгера
- Используй встроенный модуль logging Python
- Установи формат: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
```

**Ожидаемый результат:**
1. Агент повторно проверяет (запускается по `/retry` комментарию или ручному возврату метки)
2. Валидация пройдена
3. Агент создаёт ветку `fix-issue-<N>`
4. Генерирует код для `src/utils/logger.py`
5. Создаёт Pull Request с реализацией
6. Dashboard показывает timeline:
   - Started working on Issue
   - Validation Passed
   - Analyzing repository
   - Applying changes to 1 files
   - PR Created

### Проверка

- **Ветка**: Убедитесь, что создана ветка `fix-issue-<N>`
- **PR**: Проверьте, что PR содержит `src/utils/logger.py` с корректной реализацией
- **Dashboard**: Timeline показывает все шаги агента с иконками

---

## Метрики производительности

10 алгоритмических задач протестировано (скрипт: `experiments/benchmark.py`, модель: gpt-4o-mini):

| Метрика | Значение | Комментарий |
| :--- | :--- | :--- |
| **Success Rate** | **100%** | 10/10 задач решены корректно |
| **Avg. Time** | **~7.2s** | Время генерации (без учёта CI/CD) |
| **Iterations** | **1.0** | Все задачи решены с первого раза (zero-shot) |

### Эксперимент по исправлению ошибок

**Сценарий**: Приложение-калькулятор с `ZeroDivisionError` при пустом списке оценок.

**Результат**: Агент проанализировал `main.py` и `calculator.py`, обнаружил ошибку, добавил проверку на пустой список. Остальной код не изменён.

*Полный отчёт*: `experiments/BUG_FIX_REPORT.md`

---

## Варианты использования

### Вариант 1: Использовать размещённый агент (Самый быстрый)

1. Установите GitHub App: [MegaSchool Agent](https://github.com/apps/megaschool-agent-sikion)
2. Выберите репозитории для предоставления доступа
3. **ВАЖНО**: В настройках репозитория `Settings` → `Actions` → `General` → `Workflow permissions`:
   - Включите **"Allow GitHub Actions to create and approve pull requests"**
4. Создайте Issue с меткой `ready-to-code`

*Примечание: Работает на нашем демонстрационном сервере.*

### Вариант 2: Запуск в ваших GitHub Actions (Ваши API ключи)

1. Сделайте Fork этого репозитория
2. Добавьте секреты в `Settings` → `Secrets and variables` → `Actions`:
   - `LLM_API_KEY`: Ваш ключ OpenAI/Yandex API
   - `YC_FOLDER_ID`: ID папки Yandex Cloud (если используете YandexGPT)
   - `DASHBOARD_API_URL`: URL вашего dashboard (опционально, для логов)
3. Включите workflows во вкладке `Actions`

Агент работает в вашем fork, используя ваши ключи.

### Вариант 3: Собственный сервер с Webhooks (Продвинутый)

Для полного контроля над webhooks и серверной инфраструктурой:

См. [docs/github_app_setup.md](docs/github_app_setup.md) для создания и настройки GitHub App.

### Вариант 4: Docker / Docker Compose

**Docker:**
```bash
docker build -t megaschool-agent .
docker run -d -p 8000:8080 --env-file .env --name my-agent megaschool-agent
```

**Docker Compose** (рекомендуется):
```bash
docker-compose up -d --build
```

Сервер запускается на `http://localhost:8000`. Используйте ngrok для webhooks.

---

## Конфигурация

Поддерживает любую LLM, совместимую с OpenAI (включая YandexGPT):

- `LLM_BASE_URL`: Адрес API (по умолчанию: `https://api.openai.com/v1`)
- `LLM_MODEL`: Имя модели (например, `gpt-4o`, `yandexgpt-lite`)
- `MAX_ITERATIONS`: Макс. количество попыток исправления (по умолчанию: 5)

---

## Контакты

Автор: Муравья Никита Романович  
Telegram: [t.me/nmuravya](https://t.me/nmuravya)

*Разработано в рамках конкурса MegaSchool.*
